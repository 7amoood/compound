const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.esm-Cgd8yjKO.js","assets/index.esm-BJAW3Jpj.js","assets/index.esm-C3YETN53.js"])))=>i.map(i=>d[i]);
import{_ as p,a}from"./app-DSuFKixV.js";import{c as g,o as f,d as r,l as m,n as c,t as y,E as v,a as w}from"./vendor-CjkqsXjI.js";const _={name:"PullToRefresh",props:{threshold:{type:Number,default:80},onRefresh:{type:Function,required:!0}},data(){return{startY:0,currentY:0,pullDelta:0,isLoading:!1,isDragging:!1,canPull:!1}},computed:{indicatorStyle(){const e=Math.min(this.pullDelta/this.threshold,1);return{height:`${this.pullDelta}px`,opacity:e,transition:this.isDragging?"none":"height 0.4s cubic-bezier(0.19, 1, 0.22, 1), opacity 0.3s ease"}},contentStyle(){const t=1-Math.min(this.pullDelta/this.threshold,1)*(1-.25);return{transform:`translateY(${this.pullDelta}px)`,opacity:t,transition:this.isDragging?"none":"transform 0.4s cubic-bezier(0.19, 1, 0.22, 1), opacity 0.4s ease"}},iconRotateStyle(){return this.isLoading?{}:{transform:`rotate(${this.pullDelta>this.threshold?180:0}deg)`,transition:"transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1)"}}},mounted(){this.$refs.container.addEventListener("touchstart",this.onTouchStart,{passive:!0}),this.$refs.container.addEventListener("touchmove",this.onTouchMove,{passive:!1}),this.$refs.container.addEventListener("touchend",this.onTouchEnd,{passive:!0})},beforeUnmount(){this.$refs.container&&(this.$refs.container.removeEventListener("touchstart",this.onTouchStart),this.$refs.container.removeEventListener("touchmove",this.onTouchMove),this.$refs.container.removeEventListener("touchend",this.onTouchEnd))},methods:{onTouchStart(e){if(this.isLoading)return;const s=this.getScrollParent(this.$refs.container);let t=0;s?t=s.scrollTop:t=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,t<=0?(this.canPull=!0,this.startY=e.touches[0].clientY):this.canPull=!1},onTouchMove(e){if(!this.canPull||this.isLoading)return;const t=e.touches[0].clientY-this.startY,i=45;t>i?(this.isDragging=!0,this.pullDelta=Math.pow(t-i,.85),e.cancelable&&e.preventDefault()):t<0&&(this.pullDelta=0,this.isDragging=!1)},async onTouchEnd(){if(!this.canPull||this.isLoading)return;const e=this.pullDelta>=this.threshold;if(this.isDragging=!1,this.canPull=!1,e){this.isLoading=!0,this.pullDelta=60;try{await this.onRefresh()}finally{this.isLoading=!1,this.pullDelta=0}}else this.pullDelta=0},getScrollParent(e){let s=e.parentElement;for(;s;){const i=window.getComputedStyle(s).getPropertyValue("overflow-y");if((i==="auto"||i==="scroll")&&s.scrollHeight>s.clientHeight)return s;s=s.parentElement}return null}}},D={ref:"container",class:"pull-to-refresh-wrapper"};function E(e,s,t,i,n,o){return f(),g("div",D,[r("div",{class:"ptr-indicator",style:c(o.indicatorStyle)},[r("div",{class:m(["ptr-icon-box",{"ptr-loading":n.isLoading}])},[r("span",{class:"material-symbols-outlined font-bold",style:c(o.iconRotateStyle)},y(n.isLoading?"progress_activity":"arrow_downward"),5)],2)],4),r("div",{style:c(o.contentStyle),class:"ptr-content"},[v(e.$slots,"default",{},void 0)],4)],512)}const L=p(_,[["render",E],["__scopeId","data-v-f7f15a1f"]]),b={apiKey:"AIzaSyCf6DUu21s4qhbD2fLkSypCRDkSnCbzQCo",authDomain:"garden-city-compound.firebaseapp.com",projectId:"garden-city-compound",storageBucket:"garden-city-compound.firebasestorage.app",messagingSenderId:"358088420520",appId:"1:358088420520:web:7cdd88dc6d98d2c6f0269d"};let l=null,u=null,h=null;async function d(){if(!l){const{initializeApp:e}=await a(async()=>{const{initializeApp:t}=await import("./index.esm-Cgd8yjKO.js");return{initializeApp:t}},__vite__mapDeps([0,1])),{getMessaging:s}=await a(async()=>{const{getMessaging:t}=await import("./index.esm-C3YETN53.js");return{getMessaging:t}},__vite__mapDeps([2,1]));l=e(b),u=s(l)}return u}async function P(){if(h)return;const{onMessage:e}=await a(async()=>{const{onMessage:t}=await import("./index.esm-C3YETN53.js");return{onMessage:t}},__vite__mapDeps([2,1])),s=await d();h=e(s,t=>{console.log("Foreground message received:",t),window.dispatchEvent(new CustomEvent("fcm-message",{detail:t}))})}async function k(){if(!("serviceWorker"in navigator)||!("Notification"in window)){console.warn("Push is not supported");return}try{if(await Notification.requestPermission()==="granted"){const{getToken:s}=await a(async()=>{const{getToken:o}=await import("./index.esm-C3YETN53.js");return{getToken:o}},__vite__mapDeps([2,1])),t=await d(),i=await navigator.serviceWorker.register("/service-worker.js");await navigator.serviceWorker.ready,await new Promise(o=>setTimeout(o,300));const n=await s(t,{vapidKey:"BC6EtV4AwjM5kQj92nuF9b31rzDE1Pj7htPT6ESqa8yGD10Uln3QHrApWppge6Uexd9UsQFCdbtXvoDBR-D4-6E",serviceWorkerRegistration:i});n&&sessionStorage.getItem("fcm_token")!==n&&(await w.post("/api/notifications/save-token",{token:n}),sessionStorage.setItem("fcm_token",n)),await P()}}catch(e){console.error("FCM Error:",e)}}export{L as P,k as r};
