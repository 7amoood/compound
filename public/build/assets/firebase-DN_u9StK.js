const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.esm-Cgd8yjKO.js","assets/index.esm-BJAW3Jpj.js","assets/index.esm-C3YETN53.js"])))=>i.map(i=>d[i]);
import{_ as p,a}from"./app-zgBlwGFw.js";import{c as g,o as f,d as r,k as m,n as l,t as v,B as y,a as w}from"./vendor-DhvMcwBQ.js";const _={name:"PullToRefresh",props:{threshold:{type:Number,default:80},onRefresh:{type:Function,required:!0}},data(){return{startY:0,currentY:0,pullDelta:0,isLoading:!1,isDragging:!1,canPull:!1}},computed:{indicatorStyle(){const t=Math.min(this.pullDelta/this.threshold,1);return{height:`${this.pullDelta}px`,opacity:t,transition:this.isDragging?"none":"height 0.4s cubic-bezier(0.19, 1, 0.22, 1), opacity 0.3s ease"}},contentStyle(){return{transform:`translateY(${this.pullDelta}px)`,transition:this.isDragging?"none":"transform 0.4s cubic-bezier(0.19, 1, 0.22, 1)"}},iconRotateStyle(){return this.isLoading?{}:{transform:`rotate(${this.pullDelta>this.threshold?180:0}deg)`,transition:"transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1)"}}},mounted(){this.$refs.container.addEventListener("touchstart",this.onTouchStart,{passive:!0}),this.$refs.container.addEventListener("touchmove",this.onTouchMove,{passive:!1}),this.$refs.container.addEventListener("touchend",this.onTouchEnd,{passive:!0})},beforeUnmount(){this.$refs.container&&(this.$refs.container.removeEventListener("touchstart",this.onTouchStart),this.$refs.container.removeEventListener("touchmove",this.onTouchMove),this.$refs.container.removeEventListener("touchend",this.onTouchEnd))},methods:{onTouchStart(t){if(this.isLoading)return;const s=this.getScrollParent(this.$refs.container);let e=0;s?e=s.scrollTop:e=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,e<=0?(this.canPull=!0,this.startY=t.touches[0].clientY):this.canPull=!1},onTouchMove(t){if(!this.canPull||this.isLoading)return;const e=t.touches[0].clientY-this.startY;e>0?(this.isDragging=!0,this.pullDelta=Math.pow(e,.85),t.cancelable&&t.preventDefault()):(this.pullDelta=0,this.isDragging=!1)},async onTouchEnd(){if(!this.canPull||this.isLoading)return;const t=this.pullDelta>=this.threshold;if(this.isDragging=!1,this.canPull=!1,t){this.isLoading=!0,this.pullDelta=60;try{await this.onRefresh()}finally{this.isLoading=!1,this.pullDelta=0}}else this.pullDelta=0},getScrollParent(t){let s=t.parentElement;for(;s;){const o=window.getComputedStyle(s).getPropertyValue("overflow-y");if((o==="auto"||o==="scroll")&&s.scrollHeight>s.clientHeight)return s;s=s.parentElement}return null}}},D={ref:"container",class:"pull-to-refresh-wrapper"};function E(t,s,e,o,i,n){return f(),g("div",D,[r("div",{class:"ptr-indicator",style:l(n.indicatorStyle)},[r("div",{class:m(["ptr-icon-box",{"ptr-loading":i.isLoading}])},[r("span",{class:"material-symbols-outlined font-bold",style:l(n.iconRotateStyle)},v(i.isLoading?"progress_activity":"arrow_downward"),5)],2)],4),r("div",{style:l(n.contentStyle),class:"ptr-content"},[y(t.$slots,"default",{},void 0)],4)],512)}const L=p(_,[["render",E],["__scopeId","data-v-fabb7063"]]),b={apiKey:"AIzaSyCf6DUu21s4qhbD2fLkSypCRDkSnCbzQCo",authDomain:"garden-city-compound.firebaseapp.com",projectId:"garden-city-compound",storageBucket:"garden-city-compound.firebasestorage.app",messagingSenderId:"358088420520",appId:"1:358088420520:web:7cdd88dc6d98d2c6f0269d"};let c=null,u=null,h=null;async function d(){if(!c){const{initializeApp:t}=await a(async()=>{const{initializeApp:e}=await import("./index.esm-Cgd8yjKO.js");return{initializeApp:e}},__vite__mapDeps([0,1])),{getMessaging:s}=await a(async()=>{const{getMessaging:e}=await import("./index.esm-C3YETN53.js");return{getMessaging:e}},__vite__mapDeps([2,1]));c=t(b),u=s(c)}return u}async function P(){if(h)return;const{onMessage:t}=await a(async()=>{const{onMessage:e}=await import("./index.esm-C3YETN53.js");return{onMessage:e}},__vite__mapDeps([2,1])),s=await d();h=t(s,e=>{console.log("Foreground message received:",e),window.dispatchEvent(new CustomEvent("fcm-message",{detail:e}))})}async function k(){if(!("serviceWorker"in navigator)||!("Notification"in window)){console.warn("Push is not supported");return}try{if(await Notification.requestPermission()==="granted"){const{getToken:s}=await a(async()=>{const{getToken:n}=await import("./index.esm-C3YETN53.js");return{getToken:n}},__vite__mapDeps([2,1])),e=await d(),o=await navigator.serviceWorker.register("/service-worker.js");await navigator.serviceWorker.ready,await new Promise(n=>setTimeout(n,300));const i=await s(e,{vapidKey:"BC6EtV4AwjM5kQj92nuF9b31rzDE1Pj7htPT6ESqa8yGD10Uln3QHrApWppge6Uexd9UsQFCdbtXvoDBR-D4-6E",serviceWorkerRegistration:o});i&&sessionStorage.getItem("fcm_token")!==i&&(await w.post("/api/notifications/save-token",{token:i}),sessionStorage.setItem("fcm_token",i)),await P()}}catch(t){console.error("FCM Error:",t)}}export{L as P,k as r};
