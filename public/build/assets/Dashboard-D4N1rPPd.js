import{_ as j,h as D,r as y,c as a,o as l,a as f,g,b as e,n as R,t as n,d,i as w,F as p,f as m,e as x,l as P,w as k,j as q,v as C,m as c,u as z}from"./app-CCSay6Da.js";import{T as S,M as U}from"./Modal-gf0Zg2lT.js";import{P as F,r as A}from"./firebase-CEwLeahS.js";/* empty css            */const V={name:"ResidentDashboard",components:{Head:D,Modal:U,Toast:S,PullToRefresh:F},data(){return{requests:[],categories:[],loading:!0,activeTab:"pending",showNewRequestModal:!1,showRequestDetailsModal:!1,showRatingModal:!1,showNotificationsModal:!1,selectedRequest:null,currentRating:5,ratingComment:"",submittingRate:!1,notifications:[],nextNotificationsUrl:null,loadingMoreNotifications:!1,unreadNotificationsCount:0,newRequestForm:{service_category_id:"",delivery_method:"",notes:""},submittingRequest:!1,tabs:[{id:"pending",label:"قيد الانتظار"},{id:"accepted_offer",label:"تم قبول عرض"},{id:"in_progress",label:"جاري التنفيذ"},{id:"completed",label:"مكتمل"},{id:"cancelled",label:"ملغي"}],currentProposals:[],loadingProposals:!1,proposalsSort:"default",showConfirmModal:!1,confirmMessage:"",confirmAction:null,processingConfirm:!1}},computed:{user(){const r=z();return r.props.auth?r.props.auth.user:{}},selectedServiceCategory(){return this.categories.find(r=>r.id===this.newRequestForm.service_category_id)},availableDeliveryMethods(){return this.selectedServiceCategory?.delivery_methods||[]},sortedProposals(){let r=[...this.currentProposals];return this.proposalsSort==="price_asc"?r.sort((t,u)=>t.price-u.price):this.proposalsSort==="rating_desc"?r.sort((t,u)=>(u.provider?.rating_average||0)-(t.provider?.rating_average||0)):r.sort((t,u)=>{const v=t.provider?.rating_average||0,s=u.provider?.rating_average||0;return s!==v?s-v:t.price-u.price}),r}},watch:{activeTab(r){const t=new URL(window.location);t.searchParams.set("tab",r),window.history.replaceState(null,"",t),this.loadRequests()}},mounted(){const r=new URLSearchParams(window.location.search);r.has("tab")&&(this.activeTab=r.get("tab")),r.has("request_id")&&this.openRequestDetails(parseInt(r.get("request_id"))),this.loadCategories(),this.loadRequests(),this.loadUnreadCount(),A()},methods:{async triggerRefresh(){await Promise.all([this.loadCategories(),this.loadRequests(),this.loadUnreadCount()])},getServiceColor(r){const t=["bg-blue-50 text-blue-600 border-blue-100 dark:bg-blue-900/20 dark:text-blue-400 dark:border-blue-800/50","bg-emerald-50 text-emerald-600 border-emerald-100 dark:bg-emerald-900/20 dark:text-emerald-400 dark:border-emerald-800/50","bg-purple-50 text-purple-600 border-purple-100 dark:bg-purple-900/20 dark:text-purple-400 dark:border-purple-800/50","bg-amber-50 text-amber-600 border-amber-100 dark:bg-amber-900/20 dark:text-amber-400 dark:border-amber-800/50","bg-rose-50 text-rose-600 border-rose-100 dark:bg-rose-900/20 dark:text-rose-400 dark:border-rose-800/50","bg-cyan-50 text-cyan-600 border-cyan-100 dark:bg-cyan-900/20 dark:text-cyan-400 dark:border-cyan-800/50"];return t[r%t.length]},async loadRequests(){this.loading=!0;try{const r=await c.get(`/api/requests?status=${this.activeTab}`);r.data.success&&(this.requests=r.data.requests.data)}catch(r){console.error(r)}finally{this.loading=!1}},async loadCategories(){try{const r=await c.get("/api/active-categories");r.data.success&&(this.categories=r.data.categories)}catch(r){console.error(r)}},async submitNewRequest(){this.submittingRequest=!0;try{const r=await c.post("/api/requests",this.newRequestForm);r.data.success?(this.showNewRequestModal=!1,this.newRequestForm={service_category_id:"",notes:""},window.showToast("تم إرسال طلبك بنجاح","success"),this.activeTab="pending"):window.showToast(r.data.message||"حدث خطأ","error")}catch{window.showToast("حدث خطأ أثناء إرسال الطلب","error")}finally{this.submittingRequest=!1}},async openRequestDetails(r){this.showRequestDetailsModal=!0,this.loadingProposals=!0,this.currentProposals=[],this.selectedRequest=this.requests.find(t=>t.id===r);try{const[t,u]=await Promise.all([c.get(`/api/requests/${r}`),c.get(`/api/requests/${r}/proposals`)]);t.data.success&&(this.selectedRequest=t.data.request),u.data.success&&(this.currentProposals=u.data.proposals)}catch(t){console.error(t),window.showToast("تعذر تحميل التفاصيل","error")}finally{this.loadingProposals=!1}},acceptProposal(r){this.confirmMessage="هل أنت متأكد من قبول هذا العرض؟ سيتم بدء العمل فوراً وسيتم خصم المبلغ المتفق عليه.",this.showConfirmModal=!0,this.confirmAction=async()=>{this.processingConfirm=!0;try{const t=await c.post(`/api/proposals/${r.id}/accept`);t.data.success?(window.showToast("تم قبول العرض بنجاح","success"),this.showRequestDetailsModal=!1,this.showConfirmModal=!1,this.activeTab="accepted_offer",this.loadRequests()):(window.showToast(t.data.message,"error"),this.showConfirmModal=!1)}catch{window.showToast("حدث خطأ أثناء قبول العرض","error"),this.showConfirmModal=!1}finally{this.processingConfirm=!1}}},async handleNotificationClick(r){if(!r.is_read){try{c.post(`/api/notifications/${r.id}/read`)}catch{}r.is_read=!0,this.unreadNotificationsCount=Math.max(0,this.unreadNotificationsCount-1)}this.showNotificationsModal=!1,r.data&&r.data.request_id&&this.openRequestDetails(r.data.request_id)},openRating(r){this.selectedRequest=r,this.showRatingModal=!0,this.currentRating=5,this.ratingComment=""},async submitRating(){if(this.selectedRequest){this.submittingRate=!0;try{const r=await c.post("/api/reviews",{request_id:this.selectedRequest.id,rating:this.currentRating,comment:this.ratingComment});r.data.success?(window.showToast("شكراً لتقييمك!","success"),this.showRatingModal=!1,this.loadRequests()):window.showToast(r.data.message,"error")}catch{window.showToast("حدث خطأ","error")}finally{this.submittingRate=!1}}},confirmCancelRequest(r){this.confirmMessage="هل أنت متأكد من إلغاء هذا الطلب؟ لن تتمكن من التراجع عن هذا الإجراء.",this.showConfirmModal=!0,this.confirmAction=async()=>{this.processingConfirm=!0;try{const t=await c.post(`/api/requests/${r.id}/cancel`);t.data.success?(window.showToast("تم إلغاء الطلب بنجاح","success"),this.showRequestDetailsModal=!1,this.showConfirmModal=!1,this.activeTab="cancelled",this.loadRequests()):(window.showToast(t.data.message||"حدث خطأ","error"),this.showConfirmModal=!1)}catch(t){console.error(t),window.showToast("حدث خطأ أثناء إلغاء الطلب","error"),this.showConfirmModal=!1}finally{this.processingConfirm=!1}}},async loadNotifications(){try{const r=await c.get("/api/notifications");r.data.success&&(this.notifications=r.data.notifications.data||r.data.notifications,this.nextNotificationsUrl=r.data.notifications.next_page_url||null,this.loadUnreadCount())}catch(r){console.error(r)}},async loadMoreNotifications(){if(!(!this.nextNotificationsUrl||this.loadingMoreNotifications)){this.loadingMoreNotifications=!0;try{const r=await c.get(this.nextNotificationsUrl);r.data.success&&(this.notifications=[...this.notifications,...r.data.notifications.data],this.nextNotificationsUrl=r.data.notifications.next_page_url||null)}catch(r){console.error(r)}finally{this.loadingMoreNotifications=!1}}},async markAllNotificationsAsRead(){try{(await c.post("/api/notifications/read-all")).data.success&&(this.notifications.forEach(t=>t.is_read=!0),this.unreadNotificationsCount=0,window.showToast("تم تحديد الكل كمقروء","success"))}catch(r){console.error(r),window.showToast("حدث خطأ","error")}},async loadUnreadCount(){try{const r=await c.get("/api/notifications/unread-count");r.data.success&&(this.unreadNotificationsCount=r.data.count)}catch{}},formatDate(r){return new Date(r).toLocaleDateString("ar-EG",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}}},B={class:"bg-background-light dark:bg-background-dark text-slate-900 dark:text-slate-100 font-display transition-colors duration-200 antialiased pb-24",dir:"rtl"},L={class:"sticky top-0 z-20 bg-background-light/95 dark:bg-background-dark/95 backdrop-blur-md border-b border-transparent transition-all duration-200"},E={class:"flex items-center justify-between px-4 py-3 max-w-md mx-auto"},H={class:"flex items-center gap-3"},I={class:"flex flex-col"},G={class:"text-sm font-bold text-slate-900 dark:text-white leading-none"},J={key:0,class:"absolute top-2 right-2 size-2 bg-red-500 rounded-full border border-white dark:border-surface-dark"},K={class:"flex flex-col gap-6 pt-4 max-w-md mx-auto"},O={class:"px-4"},Q={class:"text-3xl font-bold text-slate-900 dark:text-white tracking-tight"},W={class:"px-4"},X={class:"grid grid-cols-4 gap-3"},Y=["onClick"],Z={class:"material-symbols-outlined text-[28px]"},$={class:"text-xs font-medium text-slate-600 dark:text-slate-300"},ee={class:"px-4"},te={class:"flex flex-col gap-4"},se={class:"flex flex-col gap-3"},oe={class:"flex gap-2 px-4 overflow-x-auto no-scrollbar pb-1"},re=["onClick"],ae={class:"flex flex-col gap-3 px-4"},le={key:0,class:"text-center py-8 text-slate-400"},ie={key:1,class:"text-center py-8 text-slate-400"},ne=["onClick"],de={class:"flex items-start justify-between gap-4"},ce={class:"flex items-center gap-4"},ue={class:"material-symbols-outlined"},be={class:"flex flex-col"},pe={class:"text-base font-bold text-slate-900 dark:text-white leading-tight"},fe={class:"text-sm text-slate-500 dark:text-slate-400 mt-1"},me={class:"shrink-0"},xe={key:0,class:"mt-3 flex items-center justify-center gap-1 text-xs font-semibold text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 px-3 py-2 rounded-xl w-full"},ge=["onClick"],he={class:"space-y-6"},we={class:"space-y-2"},ye={class:"relative"},ke=["value"],ve={key:0,class:"space-y-2"},_e={class:"flex flex-col gap-3"},Re=["onClick"],qe={class:"space-y-2"},Ce=["disabled"],Me={key:0,class:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"},Ne={key:0,class:"space-y-6"},Te={class:"flex items-center gap-3 border-b border-slate-100 dark:border-slate-800 pb-4"},je={class:"flex items-center justify-center size-14 rounded-2xl bg-slate-50 dark:bg-slate-800 text-primary"},De={class:"material-symbols-outlined text-[28px]"},Pe={class:"font-bold text-lg text-slate-900 dark:text-white"},ze={class:"text-sm text-slate-500 dark:text-slate-400"},Se={key:0,class:"bg-blue-50 dark:bg-blue-900/20 rounded-xl p-4 border border-blue-100 dark:border-blue-800"},Ue={class:"flex items-center justify-between"},Fe={class:"flex items-center gap-3"},Ae={class:"font-bold text-slate-900 dark:text-white text-sm"},Ve={class:"text-xs text-slate-500"},Be={class:"font-bold text-lg text-emerald-600"},Le={key:1,class:"space-y-3"},Ee={class:"flex items-center justify-between"},He={class:"font-bold text-slate-900 dark:text-white"},Ie={key:0,class:"text-center py-6 text-slate-400"},Ge={key:1,class:"text-center py-6 text-slate-400 bg-slate-50 dark:bg-slate-800/50 rounded-xl border border-dashed border-slate-200 dark:border-slate-700"},Je={key:2,class:"space-y-3"},Ke={class:"flex justify-between items-start mb-3"},Oe={class:"flex items-center gap-3"},Qe={class:"font-bold text-slate-900 dark:text-white text-sm"},We={class:"flex items-center gap-1 text-xs text-amber-500"},Xe={class:"font-medium text-slate-700 dark:text-slate-300"},Ye={class:"text-slate-400"},Ze={class:"font-bold text-lg text-emerald-600"},$e={key:0,class:"text-sm text-slate-600 dark:text-slate-300 bg-slate-50 dark:bg-slate-900/50 p-2 rounded-lg mb-3"},et=["onClick"],tt={key:2,class:"pt-2"},st={key:3,class:"pt-2"},ot={class:"bg-amber-50 dark:bg-amber-900/20 p-4 rounded-xl border border-amber-200 dark:border-amber-800"},rt={class:"flex items-center justify-between mb-2"},at={class:"flex items-center gap-1 bg-amber-100 dark:bg-amber-900/40 px-2 py-1 rounded-lg"},lt={class:"font-bold text-amber-600 dark:text-amber-400 text-sm"},it={key:0,class:"text-sm text-slate-600 dark:text-slate-300 leading-relaxed"},nt={class:"text-xs text-slate-400 mt-2"},dt={key:4,class:"pt-2"},ct={key:0,class:"flex items-center justify-between mb-4 px-1"},ut={class:"space-y-3 max-h-[60vh] overflow-y-auto pr-1"},bt={key:0,class:"text-center py-8 text-slate-400"},pt=["onClick"],ft={class:"flex-1 min-w-0"},mt={class:"text-sm font-bold text-slate-900 dark:text-white"},xt={class:"text-xs text-slate-500 dark:text-slate-400 mt-0.5"},gt={class:"text-[10px] text-slate-400 mt-1"},ht={key:0,class:"size-2 bg-primary rounded-full flex-shrink-0 mt-2"},wt=["disabled"],yt={key:0,class:"material-symbols-outlined animate-spin text-[18px]"},kt={class:"text-center space-y-4"},vt={class:"flex justify-center gap-2",dir:"ltr"},_t=["onClick"],Rt=["disabled"],qt={key:0,class:"material-symbols-outlined animate-spin"},Ct={class:"space-y-4"},Mt={class:"bg-amber-50 dark:bg-amber-900/20 p-4 rounded-xl flex gap-3 text-amber-800 dark:text-amber-200"},Nt={class:"text-sm font-medium leading-relaxed"},Tt={class:"flex gap-3"},jt=["disabled"],Dt={key:0,class:"material-symbols-outlined animate-spin text-[18px]"};function Pt(r,t,u,v,s,i){const M=y("Head"),N=y("Toast"),h=y("Modal"),T=y("PullToRefresh");return l(),a(p,null,[f(M,{title:"لوحة التحكم - ساكن"}),f(N),f(T,{onRefresh:i.triggerRefresh},{default:g(()=>[e("div",B,[e("header",L,[e("div",E,[e("div",H,[e("div",{class:"bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10 ring-2 ring-white dark:ring-slate-700 shadow-sm",style:R(`background-image: url('${i.user.photo||"https://ui-avatars.com/api/?name="+i.user.name}');`)},null,4),e("div",I,[t[19]||(t[19]=e("span",{class:"text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider"},"ساكن",-1)),e("span",G,n(i.user.block_no&&i.user.apt_no?`مبنى ${i.user.block_no}${i.user.floor?"، الطابق "+i.user.floor:""}، شقة ${i.user.apt_no}`:"يرجى تحديث العنوان"),1)])]),e("button",{onClick:t[0]||(t[0]=o=>{s.showNotificationsModal=!0,i.loadNotifications()}),class:"flex items-center justify-center size-10 rounded-full bg-white dark:bg-surface-dark text-slate-600 dark:text-slate-300 shadow-sm border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors relative"},[t[20]||(t[20]=e("span",{class:"material-symbols-outlined text-[24px]"},"notifications",-1)),s.unreadNotificationsCount>0?(l(),a("span",J)):d("",!0)])])]),e("main",K,[e("div",O,[e("h1",Q,[t[21]||(t[21]=w("صباح الخير،",-1)),t[22]||(t[22]=e("br",null,null,-1)),w(n(i.user.name?.split(" ")[0]),1)])]),e("div",W,[t[23]||(t[23]=e("div",{class:"flex items-center justify-between mb-3"},[e("h2",{class:"text-base font-bold text-slate-900 dark:text-white"},"خدمات سريعة")],-1)),e("div",X,[(l(!0),a(p,null,m(s.categories,(o,b)=>(l(),a("button",{key:o.id,onClick:_=>{s.newRequestForm.service_category_id=o.id,s.showNewRequestModal=!0},class:"flex flex-col items-center gap-2 group"},[e("div",{class:x(["flex items-center justify-center size-14 rounded-2xl border group-hover:scale-105 transition-transform duration-200 shadow-sm",i.getServiceColor(b)])},[e("span",Z,n(o.icon),1)],2),e("span",$,n(o.name),1)],8,Y))),128))])]),e("div",ee,[e("button",{onClick:t[1]||(t[1]=o=>s.showNewRequestModal=!0),class:"w-full flex items-center justify-center gap-2 bg-primary hover:bg-blue-600 text-white font-bold h-14 rounded-xl shadow-lg shadow-blue-500/20 active:scale-[0.98] transition-all duration-200"},[...t[24]||(t[24]=[e("span",{class:"material-symbols-outlined"},"add_circle",-1),e("span",null,"طلب خدمة جديدة",-1)])])]),e("div",te,[e("div",se,[t[25]||(t[25]=e("div",{class:"px-4 flex items-center justify-between"},[e("h2",{class:"text-lg font-bold text-slate-900 dark:text-white"},"سجل الطلبات"),e("a",{class:"text-sm font-semibold text-primary hover:text-blue-500",href:"#"},"عرض الكل")],-1)),e("div",oe,[(l(!0),a(p,null,m(s.tabs,o=>(l(),a("button",{key:o.id,onClick:b=>s.activeTab=o.id,class:x(["shrink-0 h-8 px-4 rounded-full text-sm font-semibold shadow-sm transition-colors",s.activeTab===o.id?"bg-slate-900 dark:bg-white text-white dark:text-slate-900":"bg-white dark:bg-surface-dark border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-800"])},n(o.label),11,re))),128))])]),e("div",ae,[s.loading?(l(),a("div",le,[...t[26]||(t[26]=[e("span",{class:"material-symbols-outlined text-4xl animate-spin"},"progress_activity",-1)])])):s.requests.length===0?(l(),a("div",ie,[...t[27]||(t[27]=[e("span",{class:"material-symbols-outlined text-4xl"},"inbox",-1),e("p",{class:"mt-2"},"لا توجد طلبات",-1)])])):d("",!0),(l(!0),a(p,null,m(s.requests,(o,b)=>(l(),a("div",{key:o.id,onClick:_=>i.openRequestDetails(o.id),class:"group flex flex-col bg-white dark:bg-surface-dark p-4 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 active:bg-slate-50 dark:active:bg-slate-800 transition-colors cursor-pointer"},[e("div",de,[e("div",ce,[e("div",{class:x(["flex items-center justify-center size-12 rounded-xl shrink-0",i.getServiceColor(b)])},[e("span",ue,n(o.category?.icon),1)],2),e("div",be,[e("h3",pe,n(o.category?.name),1),e("p",fe,n(i.formatDate(o.created_at)),1)])]),e("div",me,[e("span",{class:x(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold",{"bg-orange-100 dark:bg-orange-900/40 text-orange-700 dark:text-orange-300":o.status==="pending","bg-blue-100 dark:bg-blue-900/40 text-blue-700 dark:text-blue-300":o.status==="accepted_offer","bg-purple-100 dark:bg-purple-900/40 text-purple-700 dark:text-purple-300":o.status==="in_progress","bg-emerald-100 dark:bg-emerald-900/40 text-emerald-700 dark:text-emerald-300":o.status==="completed","bg-red-100 dark:bg-red-900/40 text-red-700 dark:text-red-300":o.status==="cancelled"}])},n(o.status==="pending"?"قيد الانتظار":o.status==="accepted_offer"?"تم قبول عرض":o.status==="in_progress"?"جاري التنفيذ":o.status==="completed"?"مكتمل":o.status==="cancelled"?"ملغي":o.status),3)])]),o.delivery_method?(l(),a("div",xe,[t[28]||(t[28]=e("span",{class:"material-symbols-outlined text-[16px]"},"directions_car",-1)),e("span",null,n(o.delivery_method),1)])):d("",!0),o.status==="completed"&&!o.review?(l(),a("button",{key:1,onClick:P(_=>i.openRating(o),["stop"]),class:"mt-3 w-full py-2 bg-amber-400 text-white rounded-lg text-sm font-bold shadow-sm hover:bg-amber-500 transition-colors flex items-center justify-center gap-1"},[...t[29]||(t[29]=[e("span",{class:"material-symbols-outlined text-[18px]"},"star",-1),w(" تقييم الخدمة ",-1)])],8,ge)):d("",!0)],8,ne))),128))])])]),t[53]||(t[53]=e("nav",{class:"fixed bottom-0 left-0 right-0 bg-white dark:bg-surface-dark border-t border-slate-200 dark:border-slate-800 pb-safe z-30"},[e("div",{class:"flex items-center justify-around h-16 max-w-lg mx-auto"},[e("a",{href:"/dashboard",class:"flex flex-col items-center justify-center flex-1 h-full gap-1 text-primary"},[e("span",{class:"material-symbols-outlined fill-1"},"home"),e("span",{class:"text-[10px] font-bold"},"الرئيسية")]),e("a",{href:"/settings",class:"flex flex-col items-center justify-center flex-1 h-full gap-1 text-slate-400 dark:text-slate-500 hover:text-slate-600 dark:hover:text-slate-300 transition-colors"},[e("span",{class:"material-symbols-outlined"},"person"),e("span",{class:"text-[10px] font-medium"},"الحساب")])])],-1)),f(h,{show:s.showNewRequestModal,title:"طلب خدمة جديدة",onClose:t[5]||(t[5]=o=>s.showNewRequestModal=!1)},{default:g(()=>[e("div",he,[e("div",we,[t[32]||(t[32]=e("label",{class:"block text-sm font-semibold text-slate-700 dark:text-slate-300"},"نوع الخدمة",-1)),e("div",ye,[k(e("select",{"onUpdate:modelValue":t[2]||(t[2]=o=>s.newRequestForm.service_category_id=o),class:"w-full appearance-none rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50 p-4 pr-10 text-base font-medium text-slate-900 dark:text-white focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary transition-colors"},[t[30]||(t[30]=e("option",{disabled:"",value:""},"اختر نوع الخدمة",-1)),(l(!0),a(p,null,m(s.categories,o=>(l(),a("option",{key:o.id,value:o.id},n(o.name),9,ke))),128))],512),[[q,s.newRequestForm.service_category_id]]),t[31]||(t[31]=e("div",{class:"pointer-events-none absolute inset-y-0 left-0 flex items-center px-4 text-slate-500"},[e("span",{class:"material-symbols-outlined"},"expand_more")],-1))])]),i.availableDeliveryMethods.length>0?(l(),a("div",ve,[t[33]||(t[33]=e("label",{class:"block text-sm font-semibold text-slate-700 dark:text-slate-300"},"طريقة تقديم الخدمة",-1)),e("div",_e,[(l(!0),a(p,null,m(i.availableDeliveryMethods,(o,b)=>(l(),a("div",{key:b,onClick:_=>s.newRequestForm.delivery_method=o,class:x(["cursor-pointer rounded-xl border p-3 text-center transition-all w-full",s.newRequestForm.delivery_method===o?"border-primary bg-primary/5 text-primary font-bold":"border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-600 hover:border-slate-300"])},n(o),11,Re))),128))])])):d("",!0),e("div",qe,[t[34]||(t[34]=e("label",{class:"block text-sm font-semibold text-slate-700 dark:text-slate-300"},"تفاصيل الطلب",-1)),k(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=o=>s.newRequestForm.notes=o),class:"w-full rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50 p-4 text-base font-normal text-slate-900 dark:text-white placeholder-slate-400 focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary resize-none transition-colors",placeholder:"اكتب تفاصيل المشكلة...",rows:"4"},null,512),[[C,s.newRequestForm.notes]])]),e("button",{onClick:t[4]||(t[4]=(...o)=>i.submitNewRequest&&i.submitNewRequest(...o)),disabled:s.submittingRequest||!s.newRequestForm.service_category_id,class:"flex w-full items-center justify-center gap-2 rounded-xl bg-primary py-4 text-base font-bold text-white shadow-lg shadow-primary/25 hover:bg-primary/90 focus:outline-none focus:ring-4 focus:ring-primary/20 transition-all active:scale-[0.98] disabled:opacity-50"},[s.submittingRequest?(l(),a("span",Me)):d("",!0),t[35]||(t[35]=e("span",null,"تأكيد الطلب",-1)),t[36]||(t[36]=e("span",{class:"material-symbols-outlined",style:{"font-size":"20px"}},"arrow_back",-1))],8,Ce)])]),_:1},8,["show"]),f(h,{show:s.showRequestDetailsModal,title:"تفاصيل الطلب والعروض",onClose:t[9]||(t[9]=o=>s.showRequestDetailsModal=!1)},{default:g(()=>[s.selectedRequest?(l(),a("div",Ne,[e("div",Te,[e("div",je,[e("span",De,n(s.selectedRequest.category?.icon),1)]),e("div",null,[e("h3",Pe,n(s.selectedRequest.category?.name),1),e("p",ze,n(i.formatDate(s.selectedRequest.created_at)),1),e("span",{class:x(["inline-flex items-center px-2 py-0.5 rounded-full text-xs font-bold mt-1",{"bg-orange-100 text-orange-700":s.selectedRequest.status==="pending","bg-blue-100 text-blue-700":s.selectedRequest.status==="accepted_offer","bg-purple-100 text-purple-700":s.selectedRequest.status==="in_progress","bg-emerald-100 text-emerald-700":s.selectedRequest.status==="completed","bg-red-100 text-red-700":s.selectedRequest.status==="cancelled"}])},n(s.selectedRequest.status==="pending"?"قيد الانتظار":s.selectedRequest.status==="accepted_offer"?"تم قبول عرض":s.selectedRequest.status==="in_progress"?"جاري التنفيذ":s.selectedRequest.status==="completed"?"مكتمل":s.selectedRequest.status==="cancelled"?"ملغي":s.selectedRequest.status),3)])]),s.selectedRequest.accepted_proposal?(l(),a("div",Se,[t[37]||(t[37]=e("h4",{class:"font-bold text-blue-800 dark:text-blue-300 mb-2"},"العرض المقبول",-1)),e("div",Ue,[e("div",Fe,[e("div",{class:"size-10 rounded-full bg-white dark:bg-slate-800 bg-cover bg-center",style:R(`background-image: url('${s.selectedRequest.accepted_proposal.provider?.photo||"https://ui-avatars.com/api/?name="+s.selectedRequest.accepted_proposal.provider?.name}');`)},null,4),e("div",null,[e("p",Ae,n(s.selectedRequest.accepted_proposal.provider?.name),1),e("p",Ve,n(s.selectedRequest.accepted_proposal.provider?.phone),1)])]),e("span",Be,n(s.selectedRequest.accepted_proposal.price)+" ج.م",1)])])):d("",!0),s.selectedRequest.status==="pending"?(l(),a("div",Le,[e("div",Ee,[e("h4",He,"العروض المقدمة ("+n(s.currentProposals.length)+")",1),k(e("select",{"onUpdate:modelValue":t[6]||(t[6]=o=>s.proposalsSort=o),class:"text-sm border-0 bg-transparent text-slate-500 focus:ring-0 cursor-pointer"},[...t[38]||(t[38]=[e("option",{value:"default"},"الأفضل (تقييم وسعر)",-1),e("option",{value:"price_asc"},"الأقل سعراً",-1),e("option",{value:"rating_desc"},"الأعلى تقييماً",-1)])],512),[[q,s.proposalsSort]])]),s.loadingProposals?(l(),a("div",Ie,[...t[39]||(t[39]=[e("span",{class:"material-symbols-outlined animate-spin text-2xl"},"progress_activity",-1)])])):s.currentProposals.length===0?(l(),a("div",Ge,[...t[40]||(t[40]=[e("p",{class:"text-sm"},"لم يتم تقديم عروض بعد",-1)])])):(l(),a("div",Je,[(l(!0),a(p,null,m(i.sortedProposals,o=>(l(),a("div",{key:o.id,class:"bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700"},[e("div",Ke,[e("div",Oe,[e("div",{class:"size-10 rounded-full bg-slate-100 dark:bg-slate-700 bg-cover bg-center",style:R(`background-image: url('${o.provider?.photo||"https://ui-avatars.com/api/?name="+o.provider?.name}');`)},null,4),e("div",null,[e("p",Qe,n(o.provider?.name),1),e("div",We,[t[41]||(t[41]=e("span",{class:"material-symbols-outlined text-[14px] filled"},"star",-1)),e("span",Xe,n(o.provider?.rating_average||"0.0"),1),e("span",Ye,"("+n(o.provider?.rating_count||0)+")",1)])])]),e("span",Ze,n(o.price)+" ج.م",1)]),o.notes?(l(),a("p",$e,n(o.notes),1)):d("",!0),e("button",{onClick:b=>i.acceptProposal(o),class:"w-full py-2.5 bg-primary text-white font-bold rounded-lg text-sm hover:bg-blue-600 transition-colors shadow-sm"}," قبول العرض ",8,et)]))),128))]))])):d("",!0),s.selectedRequest.status==="completed"&&!s.selectedRequest.review?(l(),a("div",tt,[e("button",{onClick:t[7]||(t[7]=o=>i.openRating(s.selectedRequest)),class:"w-full py-3 bg-amber-400 text-white font-bold rounded-xl flex items-center justify-center gap-2 hover:bg-amber-500 transition-colors"},[...t[42]||(t[42]=[e("span",{class:"material-symbols-outlined"},"star",-1),w(" تقييم الخدمة المكتملة ",-1)])])])):d("",!0),s.selectedRequest.status==="completed"&&s.selectedRequest.review?(l(),a("div",st,[e("div",ot,[e("div",rt,[t[44]||(t[44]=e("h4",{class:"font-bold text-slate-900 dark:text-white text-sm"},"تقييمك للخدمة",-1)),e("div",at,[e("span",lt,n(s.selectedRequest.review.rating),1),t[43]||(t[43]=e("span",{class:"material-symbols-outlined text-[16px] text-amber-500 filled"},"star",-1))])]),s.selectedRequest.review.comment?(l(),a("p",it,n(s.selectedRequest.review.comment),1)):d("",!0),e("p",nt,n(i.formatDate(s.selectedRequest.review.created_at)),1)])])):d("",!0),s.selectedRequest.status==="pending"?(l(),a("div",dt,[e("button",{onClick:t[8]||(t[8]=o=>i.confirmCancelRequest(s.selectedRequest)),class:"w-full py-3 bg-red-500 hover:bg-red-600 text-white font-bold rounded-xl flex items-center justify-center gap-2 transition-colors"},[...t[45]||(t[45]=[e("span",{class:"material-symbols-outlined"},"cancel",-1),w(" إلغاء الطلب ",-1)])])])):d("",!0)])):d("",!0)]),_:1},8,["show"]),f(h,{show:s.showNotificationsModal,title:"الإشعارات",onClose:t[12]||(t[12]=o=>s.showNotificationsModal=!1)},{default:g(()=>[s.notifications.length>0?(l(),a("div",ct,[t[46]||(t[46]=e("h3",{class:"text-xs font-bold text-slate-400 uppercase tracking-wider"},"سجل التنبيهات",-1)),s.unreadNotificationsCount>0?(l(),a("button",{key:0,onClick:t[10]||(t[10]=(...o)=>i.markAllNotificationsAsRead&&i.markAllNotificationsAsRead(...o)),class:"text-xs font-bold text-primary hover:underline"},"تحديد الكل كمقروء")):d("",!0)])):d("",!0),e("div",ut,[s.notifications.length===0?(l(),a("div",bt,[...t[47]||(t[47]=[e("span",{class:"material-symbols-outlined text-4xl"},"notifications_off",-1),e("p",{class:"mt-2"},"لا توجد إشعارات",-1)])])):d("",!0),(l(!0),a(p,null,m(s.notifications,o=>(l(),a("div",{key:o.id,onClick:b=>i.handleNotificationClick(o),class:x(["flex gap-3 p-3 rounded-xl cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors",o.is_read?"bg-slate-50 dark:bg-slate-800/50":"bg-primary/5 border border-primary/20"])},[t[48]||(t[48]=e("div",{class:"size-10 rounded-full flex items-center justify-center flex-shrink-0 shadow-sm bg-slate-100 text-slate-600"},[e("span",{class:"material-symbols-outlined"},"notifications")],-1)),e("div",ft,[e("h4",mt,n(o.title),1),e("p",xt,n(o.body),1),e("p",gt,n(i.formatDate(o.created_at)),1)]),o.is_read?d("",!0):(l(),a("span",ht))],10,pt))),128)),s.nextNotificationsUrl?(l(),a("button",{key:1,onClick:t[11]||(t[11]=(...o)=>i.loadMoreNotifications&&i.loadMoreNotifications(...o)),disabled:s.loadingMoreNotifications,class:"w-full mt-2 py-3 text-sm font-bold text-primary bg-primary/10 dark:bg-primary/20 hover:bg-primary/20 rounded-xl transition-colors flex items-center justify-center gap-2"},[s.loadingMoreNotifications?(l(),a("span",yt,"progress_activity")):d("",!0),e("span",null,n(s.loadingMoreNotifications?"جاري التحميل...":"تحميل المزيد"),1)],8,wt)):d("",!0)])]),_:1},8,["show"]),f(h,{show:s.showRatingModal,title:"تقييم الخدمة",onClose:t[15]||(t[15]=o=>s.showRatingModal=!1)},{default:g(()=>[e("div",kt,[t[50]||(t[50]=e("p",{class:"text-slate-600 dark:text-slate-300"},"كيف كانت تجربتك؟",-1)),e("div",vt,[(l(),a(p,null,m(5,o=>e("button",{key:o,onClick:b=>s.currentRating=o,class:x(["text-4xl transition-colors",o<=s.currentRating?"text-amber-400":"text-slate-200 dark:text-slate-700"])},"★",10,_t)),64))]),k(e("textarea",{"onUpdate:modelValue":t[13]||(t[13]=o=>s.ratingComment=o),placeholder:"اكتب تعليقك هنا...",class:"w-full p-3 rounded-xl bg-slate-50 dark:bg-slate-700/50 border-0 focus:ring-2 focus:ring-amber-400 text-sm h-24 text-right resize-none"},null,512),[[C,s.ratingComment]]),e("button",{onClick:t[14]||(t[14]=(...o)=>i.submitRating&&i.submitRating(...o)),disabled:s.submittingRate,class:"w-full py-3 bg-primary text-white font-bold rounded-xl flex items-center justify-center gap-2"},[s.submittingRate?(l(),a("span",qt,"progress_activity")):d("",!0),t[49]||(t[49]=e("span",null,"إرسال التقييم",-1))],8,Rt)])]),_:1},8,["show"]),f(h,{show:s.showConfirmModal,title:"تأكيد الإجراء",onClose:t[18]||(t[18]=o=>s.showConfirmModal=!1)},{default:g(()=>[e("div",Ct,[e("div",Mt,[t[51]||(t[51]=e("span",{class:"material-symbols-outlined text-2xl flex-shrink-0"},"warning",-1)),e("p",Nt,n(s.confirmMessage),1)]),e("div",Tt,[e("button",{onClick:t[16]||(t[16]=o=>s.showConfirmModal=!1),class:"flex-1 py-3 text-slate-600 dark:text-slate-300 font-bold bg-slate-100 dark:bg-slate-700/50 hover:bg-slate-200 dark:hover:bg-slate-700 rounded-xl transition-colors"}," إلغاء "),e("button",{onClick:t[17]||(t[17]=(...o)=>s.confirmAction&&s.confirmAction(...o)),disabled:s.processingConfirm,class:"flex-1 py-3 bg-primary text-white font-bold rounded-xl shadow-lg shadow-primary/20 flex items-center justify-center gap-2 hover:bg-blue-600 transition-colors"},[s.processingConfirm?(l(),a("span",Dt,"progress_activity")):d("",!0),t[52]||(t[52]=e("span",null,"تأكيد",-1))],8,jt)])])]),_:1},8,["show"])])]),_:1},8,["onRefresh"])],64)}const At=j(V,[["render",Pt],["__scopeId","data-v-3084a56e"]]);export{At as default};
